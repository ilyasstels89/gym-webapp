<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Tracker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #1c1c1e);
            color: var(--tg-theme-text-color, #ffffff);
            padding: 20px;
            text-align: center;
            user-select: none;
        }
        input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 12px;
            border: 1px solid #333;
            background-color: var(--tg-theme-secondary-bg-color, #2c2c2e);
            color: var(--tg-theme-text-color, #fff);
            font-size: 18px;
            box-sizing: border-box;
            outline: none;
        }
        .btn {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: 0.2s;
        }
        .btn-primary {
            background-color: var(--tg-theme-button-color, #007aff);
            color: var(--tg-theme-button-text-color, #ffffff);
        }
        .btn-danger {
            background-color: #ff3b30;
            color: white;
            margin-top: 30px;
        }
        /* –¢–∞–π–º–µ—Ä */
        #timer-screen {
            display: none;
            padding-top: 50px;
        }
        #timer-display {
            font-size: 80px;
            font-weight: bold;
            margin: 20px 0;
        }
        .stat-box {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body>

    <!-- –≠–ö–†–ê–ù –í–í–û–î–ê -->
    <div id="input-screen">
        <div class="stat-box">
            <h3 id="set-counter" style="margin:0; margin-bottom:5px;">–ü–æ–¥—Ö–æ–¥ ‚Ññ1</h3>
            <p style="margin:0; opacity: 0.6; font-size: 14px;">‚è± –í—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: <span id="total-time">00:00</span></p>
        </div>

        <div style="text-align: left; margin-bottom: 5px; opacity: 0.8; font-size: 14px;">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</div>
        <input type="text" id="exercise" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ñ–∏–º –ª–µ–∂–∞">
        
        <div style="display: flex; gap: 10px;">
            <div style="width: 50%;">
                <div style="text-align: left; margin-bottom: 5px; opacity: 0.8; font-size: 14px;">–í–µ—Å (–∫–≥)</div>
                <input type="tel" id="weight" placeholder="0">
            </div>
            <div style="width: 50%;">
                <div style="text-align: left; margin-bottom: 5px; opacity: 0.8; font-size: 14px;">–ü–æ–≤—Ç–æ—Ä—ã</div>
                <input type="tel" id="reps" placeholder="0">
            </div>
        </div>

        <button class="btn btn-primary" onclick="logSet()">‚úÖ –ì–æ—Ç–æ–≤–æ (–û—Ç–¥—ã—Ö)</button>
        <button class="btn btn-danger" onclick="finishWorkout()">üèÅ –ó–∞–∫–æ–Ω—á–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
    </div>

    <!-- –≠–ö–†–ê–ù –¢–ê–ô–ú–ï–†–ê -->
    <div id="timer-screen">
        <h2 style="opacity: 0.7;">–û—Ç–¥—ã—Ö</h2>
        <div id="timer-display">01:30</div>
        
        <button class="btn btn-primary" onclick="stopRest()">üí™ –ö —Å–ª–µ–¥—É—é—â–µ–º—É –ø–æ–¥—Ö–æ–¥—É</button>
        
        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 20px;">
            <button onclick="adjustTime(-10)" style="background:none; border:1px solid #555; color:#fff; padding: 10px 20px; border-radius: 8px;">-10 —Å–µ–∫</button>
            <button onclick="adjustTime(+10)" style="background:none; border:1px solid #555; color:#fff; padding: 10px 20px; border-radius: 8px;">+10 —Å–µ–∫</button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand(); 

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let setNumber = 1;
        let workoutData = [];
        let workoutStartTime = Date.now();
        let restInterval;
        let restTimeLeft = 90;

        // –û–±—â–∏–π —Ç–∞–π–º–µ—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        setInterval(() => {
            let diff = Math.floor((Date.now() - workoutStartTime) / 1000);
            let m = Math.floor(diff / 60).toString().padStart(2, '0');
            let s = (diff % 60).toString().padStart(2, '0');
            document.getElementById('total-time').innerText = `${m}:${s}`;
        }, 1000);

        function logSet() {
            let exercise = document.getElementById('exercise').value;
            let weight = document.getElementById('weight').value;
            let reps = document.getElementById('reps').value;

            if(!exercise) {
                tg.showAlert("–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è!");
                return;
            }
            if(!weight || !reps) {
                tg.showAlert("–í–≤–µ–¥–∏ –≤–µ—Å –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è!");
                return;
            }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            workoutData.push({
                set: setNumber,
                exercise: exercise,
                weight: weight,
                reps: reps
            });

            setNumber++;
            document.getElementById('set-counter').innerText = `–ü–æ–¥—Ö–æ–¥ ‚Ññ${setNumber}`;
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è –≤–µ—Å–∞/–ø–æ–≤—Ç–æ—Ä–æ–≤ (—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞–≤–ª—è–µ–º, –æ–±—ã—á–Ω–æ –¥–µ–ª–∞—é—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ)
            document.getElementById('weight').value = '';
            document.getElementById('reps').value = '';

            startRest(90); 
        }

        function startRest(seconds) {
            document.getElementById('input-screen').style.display = 'none';
            document.getElementById('timer-screen').style.display = 'block';
            
            restTimeLeft = seconds;
            updateTimerDisplay(restTimeLeft);

            restInterval = setInterval(() => {
                restTimeLeft--;
                updateTimerDisplay(restTimeLeft);
                if(restTimeLeft <= 0) {
                    tg.HapticFeedback.notificationOccurred('success');
                    stopRest();
                }
            }, 1000);
        }

        function updateTimerDisplay(sec) {
            let m = Math.floor(sec / 60).toString().padStart(2, '0');
            let s = (sec % 60).toString().padStart(2, '0');
            document.getElementById('timer-display').innerText = `${m}:${s}`;
        }

        function adjustTime(amount) {
            restTimeLeft += amount;
            if (restTimeLeft < 0) restTimeLeft = 0;
            updateTimerDisplay(restTimeLeft);
        }

        function stopRest() {
            clearInterval(restInterval);
            document.getElementById('timer-screen').style.display = 'none';
            document.getElementById('input-screen').style.display = 'block';
        }

        function finishWorkout() {
            if (workoutData.length === 0) {
                tg.close();
                return;
            }
            tg.sendData(JSON.stringify(workoutData));
        }
    </script>
</body>
</html>
